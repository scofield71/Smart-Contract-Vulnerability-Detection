const fetch = require('node-fetch');
const fs = require('fs/promises');

const filePath = 'scrawld_majority_unique.txt';

let modifiedLinesArray = []; // Declare modifiedLinesArray globally

async function readAndModifyFile(filePath) {
  try {
      const data = await fs.readFile(filePath, 'utf8');
      const lines = data.split('\n');
      const modifiedLines = lines.map(line => {
          const index = line.indexOf('_');
          return index !== -1 ? line.substring(0, index) : line;
      });

      modifiedLinesArray = modifiedLines; 
      // Assign modifiedLines to modifiedLinesArray

      // console.log(modifiedLinesArray); 
      // Logging inside the async function
      // You can use modifiedLinesArray here or pass it to other functions as needed
  } catch (err) {
      console.error('Error reading the file:', err);
  }
}

readAndModifyFile(filePath);

// console.log(modifiedLinesArray);
setTimeout(console.log(modifiedLinesArray),2000);

async function fetchData(address) {
    try {
      const apiUrl = `https://api.etherscan.io/api?module=contract&action=getsourcecode&address=${address}&apikey=48G1PUK91P7PE452XJUJIC3UN9Q533YAES`;
      const response = await fetch(apiUrl);
  
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
  
      const data = await response.json();
      console.log(data.result[0].SourceCode);
      //fs.writeFileSync(`sujeetDataset/${address}.sol`, data.result[0].SourceCode);
      //console.log(`${address} file written`);
    } catch (error) {
      console.error('There was a problem with the fetch operation:', error);
    }
  }

function writeInFile(){
  for(let i=0;i<2;i++){
    fetchData(modifiedLinesArray[i]);
    // console.log(typeof(modifiedLinesArray[i]));
  }
}

//setTimeout(writeInFile,5000);
  
